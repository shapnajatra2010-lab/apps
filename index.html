<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>সংগঠন ম্যানেজমেন্ট প্রো</title>
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #2ec4b6;
            --dark: #212529;
            --light: #f8f9fa;
            --danger: #ef233c;
            --shadow: 0 8px 30px rgba(0,0,0,0.08);
        }

        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: #f0f2f5;
            margin: 0;
            padding: 0;
        }

        /* প্রফেশনাল নেভিগেশন */
        .main-nav {
            display: flex;
            background: var(--primary);
            padding: 10px;
            position: sticky;
            top: 0;
            z-index: 1000;
            justify-content: center;
            gap: 10px;
        }

        .main-tab {
            padding: 12px 15px;
            border: none;
            background: rgba(255,255,255,0.1);
            color: white;
            cursor: pointer;
            font-weight: 600;
            border-radius: 8px;
            transition: 0.3s;
        }

        .main-tab.active {
            background: white;
            color: var(--primary);
        }

        .container {
            max-width: 900px;
            margin: 20px auto;
            padding: 0 15px;
        }

        .section-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: var(--shadow);
            margin-bottom: 25px;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border-bottom: 4px solid var(--primary);
        }

        .hidden { display: none !important; }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 10px;
            margin-bottom: 10px;
            box-sizing: border-box;
            font-size: 14px;
        }

        .btn {
            padding: 12px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
            transition: 0.3s;
        }

        .btn-primary { background: var(--primary); color: white; }
        .btn-success { background: var(--secondary); color: white; }
        .btn-danger { background: var(--danger); color: white; font-size: 12px; padding: 5px 10px; width: auto; border-radius: 5px; }
        .btn-edit { background: #3498db; color: white; font-size: 12px; padding: 5px 10px; width: auto; margin-right: 5px; border-radius: 5px; }

        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 12px; border-bottom: 1px solid #eee; text-align: left; font-size: 14px; }
        th { background: #f8f9fa; }

        .total-highlight {
            background: linear-gradient(135deg, var(--primary), #637dfd);
            color: white;
            padding: 15px;
            border-radius: 12px;
            margin-top: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .badge { padding: 5px 10px; border-radius: 6px; font-size: 11px; font-weight: bold; }
        .paid { background: #d1fae5; color: #065f46; }
        .due { background: #fee2e2; color: #991b1b; }
        .badge-method { background: #e0e7ff; color: #4361ee; padding: 2px 6px; border-radius: 4px; font-size: 11px; }

        #loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.8); display: none;
            justify-content: center; align-items: center; z-index: 9999;
        }
    </style>
</head>
<body>

<div id="loader"><b>প্রসেসিং হচ্ছে...</b></div>

<nav class="main-nav">
    <button class="main-tab active" id="tab-member-mode" onclick="switchMainTab('member-mode')">সার্চ প্রোফাইল</button>
    <button class="main-tab" id="tab-due-list-mode" onclick="switchMainTab('due-list-mode')">বকেয়া তালিকা</button>
    <button class="main-tab" id="tab-admin-mode" onclick="switchMainTab('admin-mode')">এডমিন প্যানেল</button>
</nav>

<div class="container">
    <div class="dashboard" id="mainDashboard">
        <div class="stat-card"><h3>মোট সংগ্রহ</h3><p>৳ <span id="org-total-collected">০</span></p></div>
        <div class="stat-card"><h3>সদস্য</h3><p><span id="org-total-members">০</span> জন</p></div>
    </div>

    <div id="member-mode" class="main-section">
        <div class="section-card">
            <div style="display: flex; gap: 10px;">
                <input type="text" id="memberSearchInput" placeholder="আইডি বা মোবাইল নম্বর...">
                <button class="btn btn-primary" style="width:100px" onclick="searchMember()">সার্চ</button>
            </div>
        </div>

        <div id="memberResult" class="section-card hidden">
            <div id="statusBadgeDisplay" style="float: right;"></div>
            <h2 id="m-name" style="margin:0; color:var(--primary);"></h2>
            <p>আইডি: <b id="m-no"></b> | পিতা: <span id="m-father"></span></p>
            <p>মোবাইল: <span id="m-mobile-disp"></span></p>
            <p>ঠিকানা: <span id="m-address"></span></p>
            
            <h4>পেমেন্ট হিস্ট্রি</h4>
            <div style="overflow-x:auto">
                <table>
                    <thead>
                        <tr><th>মাস ও বছর</th><th>টাকা</th><th>মাধ্যম</th><th>তারিখ</th></tr>
                    </thead>
                    <tbody id="m-history-body"></tbody>
                </table>
            </div>
            <div class="total-highlight">
                <span>ব্যক্তিগত মোট জমা</span>
                <span style="font-size:20px; font-weight:800;">৳ <span id="m-total-amount">০</span></span>
            </div>
        </div>
    </div>

    <div id="due-list-mode" class="main-section hidden">
        <div class="section-card">
            <h3 style="text-align: center;"><span id="currentMonthLabel"></span> বকেয়া তালিকা</h3>
            <table>
                <thead><tr><th>আইডি</th><th>নাম</th><th>অবস্থা</th></tr></thead>
                <tbody id="due-list-body"></tbody>
            </table>
        </div>
    </div>

    <div id="admin-mode" class="main-section hidden">
        <div id="admin-login-box" class="section-card" style="max-width:350px; margin:auto">
            <h4 style="text-align:center">এডমিন লগইন</h4>
            <input type="password" id="adminPass" placeholder="পাসওয়ার্ড">
            <button class="btn btn-primary" onclick="loginAdmin()">লগইন</button>
        </div>

        <div id="admin-content" class="hidden">
            <div style="display:flex; gap:10px; margin-bottom:20px">
                <button class="btn btn-primary admin-sub-btn" id="sub-tab-reg" onclick="switchAdminSub('reg')">নিবন্ধন</button>
                <button class="btn btn-primary admin-sub-btn" id="sub-tab-pay" onclick="switchAdminSub('pay')">পেমেন্ট</button>
                <button class="btn btn-primary admin-sub-btn" id="sub-tab-manage" onclick="switchAdminSub('manage')">সদস্য তালিকা</button>
            </div>

            <div id="admin-reg" class="admin-sub section-card">
                <h4 id="regTitle">নতুন সদস্য নিবন্ধন</h4>
                <input type="hidden" id="editIndex">
                <input type="text" id="regNo" placeholder="সদস্য নং (আইডি)">
                <input type="text" id="regName" placeholder="সদস্যের নাম">
                <input type="text" id="regFather" placeholder="পিতার নাম">
                <input type="text" id="regMobile" placeholder="মোবাইল নাম্বার">
                <input type="text" id="regPhoto" placeholder="গুগল ড্রাইভ ফটো লিঙ্ক (ঐচ্ছিক)">
                <textarea id="regAddress" placeholder="ঠিকানা"></textarea>
                <button id="saveBtn" class="btn btn-success" onclick="saveMember()">সেভ করুন</button>
                <button id="cancelEditBtn" class="btn hidden" style="margin-top:10px; background:#666; color:#fff" onclick="cancelEdit()">বাতিল</button>
            </div>

            <div id="admin-pay" class="admin-sub hidden section-card">
                <h4>পেমেন্ট এন্ট্রি</h4>
                <input type="text" id="payNo" placeholder="সদস্য আইডি লিখুন" oninput="showHint()">
                <div id="nameHint" style="color:var(--secondary); font-weight:bold; margin-bottom:10px; font-size: 16px;"></div>
                
                <input type="number" id="payAmount" placeholder="টাকার পরিমাণ">
                
                <label style="font-size:12px; font-weight:bold">পেমেন্ট মাধ্যম:</label>
                <select id="payMethod">
                    <option value="নগদ টাকা">নগদ টাকা (Cash)</option>
                    <option value="বিকাশ">বিকাশ (Bkash)</option>
                    <option value="নগদ">নগদ (Nagad)</option>
                    <option value="রকেট">রকেট (Rocket)</option>
                    <option value="ব্যাংক">ব্যাংক (Bank)</option>
                </select>

                <div style="display:flex; gap:5px">
                    <select id="payYear">
                        <option>২০২৪</option><option>২০২৫</option>
                        <option selected>২০২৬</option><option>২০২৭</option><option>২০২৮</option>
                    </select>
                    <select id="payMonth">
                        <option>জানুয়ারি</option><option>ফেব্রুয়ারি</option><option>মার্চ</option>
                        <option>এপ্রিল</option><option>মে</option><option>জুন</option>
                        <option>জুলাই</option><option>আগস্ট</option><option>সেপ্টেম্বর</option>
                        <option>অক্টোবর</option><option>নভেম্বর</option><option>ডিসেম্বর</option>
                    </select>
                </div>
                <button class="btn btn-success" onclick="submitPayment()">পেমেন্ট নিশ্চিত করুন</button>
            </div>

            <div id="admin-manage" class="admin-sub hidden section-card">
                <h4>সংগঠনের সকল সদস্য</h4>
                <div style="overflow-x:auto">
                    <table id="admin-member-list-table">
                        <thead><tr><th>আইডি</th><th>নাম</th><th>মোবাইল</th><th>অ্যাকশন</th></tr></thead>
                        <tbody id="admin-member-list"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const SCRIPT_URL = "YOUR_SCRIPT_URL_HERE"; // আপনার গুগল স্ক্রিপ্ট ইউআরএল এখানে বসান
    let db = [];
    const bnMonths = ["জানুয়ারি", "ফেব্রুয়ারি", "মার্চ", "এপ্রিল", "মে", "জুন", "জুলাই", "আগস্ট", "সেপ্টেম্বর", "অক্টোবর", "নভেম্বর", "ডিসেম্বর"];

    function getCurMonthYear() { 
        const d = new Date();
        return bnMonths[d.getMonth()] + " " + "২০২৬"; 
    }

    window.onload = async () => {
        document.getElementById('currentMonthLabel').innerText = getCurMonthYear();
        toggleLoader(true);
        try {
            let res = await fetch(SCRIPT_URL + "?action=load");
            db = await res.json();
            updateDashboard();
        } catch(e) {
            db = JSON.parse(localStorage.getItem('orgData')) || [];
            updateDashboard();
        }
        toggleLoader(false);
    };

    function updateDashboard() {
        let total = 0;
        db.forEach(m => {
            if(m.payments) {
                m.payments.forEach(p => total += parseFloat(p.amount) || 0);
            }
        });
        document.getElementById('org-total-collected').innerText = total.toLocaleString('bn-BD');
        document.getElementById('org-total-members').innerText = db.length.toLocaleString('bn-BD');
        localStorage.setItem('orgData', JSON.stringify(db));
        renderAdminMemberList();
    }

    async function sync() {
        toggleLoader(true);
        updateDashboard();
        try {
            await fetch(SCRIPT_URL, { 
                method: 'POST', 
                mode: 'no-cors', 
                body: JSON.stringify({action: "save", members: db}) 
            });
        } catch(e) { console.error(e); }
        setTimeout(() => toggleLoader(false), 2000);
    }

    function searchMember() {
        let key = document.getElementById('memberSearchInput').value;
        let m = db.find(i => i.no === key || i.mobile === key);
        if(!m) return alert("পাওয়া যায়নি!");
        
        document.getElementById('memberResult').classList.remove('hidden');
        document.getElementById('m-name').innerText = m.name;
        document.getElementById('m-no').innerText = m.no;
        document.getElementById('m-father').innerText = m.father || "-";
        document.getElementById('m-mobile-disp').innerText = m.mobile || "-";
        document.getElementById('m-address').innerText = m.address || "-";
        
        const cur = getCurMonthYear();
        const paid = m.payments && m.payments.some(p => p.month === cur);
        document.getElementById('statusBadgeDisplay').innerHTML = `<span class="badge ${paid ? 'paid' : 'due'}">${paid ? 'এই মাসে পরিশোধিত' : 'এই মাসে বকেয়া'}</span>`;
        
        let h = ""; let t = 0;
        if(m.payments) {
            m.payments.forEach(p => { 
                let amt = parseFloat(p.amount) || 0;
                t += amt;
                h += `<tr><td>${p.month}</td><td>৳ ${amt}</td><td><span class="badge-method">${p.method || 'নগদ'}</span></td><td>${p.date}</td></tr>`; 
            });
        }
        document.getElementById('m-history-body').innerHTML = h || "<tr><td colspan='4' style='text-align:center'>কোন রেকর্ড নেই</td></tr>";
        document.getElementById('m-total-amount').innerText = t.toLocaleString('bn-BD');
    }

    async function submitPayment() {
        let no = document.getElementById('payNo').value;
        let amt = document.getElementById('payAmount').value;
        let idx = db.findIndex(m => m.no === no);
        
        if(idx === -1) return alert("ভুল আইডি! সঠিক আইডি লিখুন।");
        if(!amt || amt <= 0) return alert("সঠিক টাকার পরিমাণ লিখুন।");
        
        let my = document.getElementById('payMonth').value + " " + document.getElementById('payYear').value;
        let method = document.getElementById('payMethod').value;

        if(!db[idx].payments) db[idx].payments = [];
        
        db[idx].payments.push({ 
            month: my, 
            amount: amt, 
            method: method,
            date: new Date().toLocaleDateString('bn-BD') 
        });
        
        await sync(); 
        alert("পেমেন্ট সফলভাবে সেভ হয়েছে!");
        document.getElementById('payAmount').value = "";
        document.getElementById('payNo').value = "";
        document.getElementById('nameHint').innerText = "";
    }

    async function saveMember() {
        let no = document.getElementById('regNo').value;
        let name = document.getElementById('regName').value;
        let editIdx = document.getElementById('editIndex').value;
        
        if(!no || !name) return alert("আইডি ও নাম অবশ্যই দিতে হবে!");

        let memberData = {
            no: no, 
            name: name,
            father: document.getElementById('regFather').value,
            mobile: document.getElementById('regMobile').value,
            photoUrl: document.getElementById('regPhoto').value,
            address: document.getElementById('regAddress').value,
            payments: editIdx !== "" ? db[editIdx].payments : []
        };

        if(editIdx !== "") { 
            db[editIdx] = memberData; 
        } else { 
            // আইডি ডুপ্লিকেট চেক
            if(db.some(m => m.no === no)) return alert("এই আইডি ইতিমধ্যে নিবন্ধিত!");
            db.push(memberData); 
        }
        
        cancelEdit(); 
        await sync();
        alert("সদস্য তথ্য সংরক্ষিত হয়েছে!");
    }

    function editMember(index) {
        let m = db[index];
        document.getElementById('editIndex').value = index;
        document.getElementById('regNo').value = m.no;
        document.getElementById('regName').value = m.name;
        document.getElementById('regFather').value = m.father || "";
        document.getElementById('regMobile').value = m.mobile || "";
        document.getElementById('regPhoto').value = m.photoUrl || "";
        document.getElementById('regAddress').value = m.address || "";
        
        document.getElementById('regTitle').innerText = "সদস্য তথ্য সংশোধন";
        document.getElementById('saveBtn').innerText = "আপডেট করুন";
        document.getElementById('cancelEditBtn').classList.remove('hidden');
        switchAdminSub('reg');
    }

    async function deleteMember(index) {
        if(confirm("আপনি কি নিশ্চিতভাবে এই সদস্যকে ডিলিট করতে চান?")) { 
            db.splice(index, 1); 
            await sync(); 
        }
    }

    function renderAdminMemberList() {
        let html = "";
        db.forEach((m, index) => {
            html += `<tr>
                <td>${m.no}</td>
                <td>${m.name}</td>
                <td>${m.mobile || '-'}</td>
                <td>
                    <button class="btn-edit" onclick="editMember(${index})">এডিট</button>
                    <button class="btn-danger" onclick="deleteMember(${index})">ডিলিট</button>
                </td>
            </tr>`;
        });
        document.getElementById('admin-member-list').innerHTML = html;
    }

    function renderDueList() {
        const cur = getCurMonthYear();
        let h = "";
        db.forEach(m => {
            const p = m.payments && m.payments.some(x => x.month === cur);
            h += `<tr><td>${m.no}</td><td>${m.name}</td><td><span class="badge ${p ? 'paid' : 'due'}">${p ? 'পরিশোধিত' : 'বকেয়া'}</span></td></tr>`;
        });
        document.getElementById('due-list-body').innerHTML = h || "<tr><td colspan='3' style='text-align:center'>কোন সদস্য নেই</td></tr>";
    }

    function switchMainTab(id) {
        document.querySelectorAll('.main-section').forEach(s => s.classList.add('hidden'));
        document.querySelectorAll('.main-tab').forEach(t => t.classList.remove('active'));
        document.getElementById(id).classList.remove('hidden');
        document.getElementById('tab-'+id).classList.add('active');
        
        if(id === 'due-list-mode') renderDueList();
        
        // এডমিন মোডে ড্যাশবোর্ড লুকানো (ঐচ্ছিক)
        if(id === 'admin-mode') document.getElementById('mainDashboard').style.display = 'none';
        else document.getElementById('mainDashboard').style.display = 'grid';
    }

    function switchAdminSub(id) {
        document.querySelectorAll('.admin-sub').forEach(s => s.classList.add('hidden'));
        document.getElementById('admin-'+id).classList.remove('hidden');
    }

    function loginAdmin() {
        if(document.getElementById('adminPass').value === "1234") {
            document.getElementById('admin-login-box').classList.add('hidden');
            document.getElementById('admin-content').classList.remove('hidden');
        } else alert("ভুল পাসওয়ার্ড! সঠিক পাসওয়ার্ড দিন।");
    }

    function cancelEdit() {
        ['regNo','regName','regFather','regMobile','regPhoto','regAddress','editIndex'].forEach(id => document.getElementById(id).value = "");
        document.getElementById('regTitle').innerText = "নতুন সদস্য নিবন্ধন";
        document.getElementById('saveBtn').innerText = "সেভ করুন";
        document.getElementById('cancelEditBtn').classList.add('hidden');
    }

    function showHint() { 
        let val = document.getElementById('payNo').value;
        let m = db.find(i => i.no === val); 
        document.getElementById('nameHint').innerText = m ? "সদস্যের নাম: " + m.name : (val ? "সদস্য পাওয়া যায়নি" : ""); 
    }

    function toggleLoader(s) { document.getElementById('loader').style.display = s ? 'flex' : 'none'; }
</script>
</body>
</html>